!function(e){var t=e.editors.TextEditor.prototype.extend();t.prototype.createElements=function(){e.editors.TextEditor.prototype.createElements.apply(this,arguments),this.unicodeModal=document.createElement("DIV"),e.Dom.addClass(this.unicodeModal,"unicode-modal"),this.unicodeModal.style.display="none",this.modalOpened=!1,this.instance.rootElement.appendChild(this.unicodeModal)},t.prototype.prepare=function(){e.editors.TextEditor.prototype.prepare.apply(this,arguments);var t=this,o=this.cellProperties.characters||[],n=document.createElement("DIV");if(e.Dom.addClass(n,"unicode-modal-inner"),o.forEach(function(o){var r=document.createElement("DIV");e.Dom.addClass(r,"character-group");var d=document.createElement("DIV");e.Dom.addClass(d,"character-group-heading");var a=document.createElement("DIV");e.Dom.addClass(a,"character-group-body"),d.innerHTML="<h1>"+o.name||"</h1>";var i=o.characters||[];i.forEach(function(o){var n=document.createElement("span");e.Dom.addClass(n,"character"),n.addEventListener("click",function(e){var o=e.target.innerHTML;t.setValue(t.getValue()+o),t.refreshDimensions()}),n.innerHTML=o,a.appendChild(n)}),r.appendChild(d),r.appendChild(a),n.appendChild(r)}),this.cellProperties.form){var r=document.createElement("FORM");e.Dom.addClass(r,"character-from");var d=document.createElement("DIV");e.Dom.addClass(d,"character-from-inner");var a=document.createElement("INPUT");e.Dom.addClass(a,"character-form-input"),a.setAttribute("type","text");var i=document.createElement("DIV");e.Dom.addClass(i,"character-form-preview"),i.style.display="none",a.addEventListener("keyup",function(e){i.innerHTML=e.target.value,e.target.value.length>0?i.style.display="":i.style.display="none"}),a.addEventListener("blur",function(){i.style.display="none"});var s=document.createElement("DIV");e.Dom.addClass(s,"character-form-button");var l=document.createElement("BUTTON");l.setAttribute("type","submit"),l.innerHTML="Submit",s.appendChild(l),d.appendChild(a),d.appendChild(s),d.appendChild(i),r.appendChild(d),n.appendChild(r),r.addEventListener("submit",function(e){e.preventDefault(),t.setValue(t.getValue()+i.innerHTML),t.refreshDimensions(),a.value="",i.innerHTML="",i.style.display="none"})}e.Dom.empty(this.unicodeModal),this.unicodeModal.appendChild(n)},t.prototype.open=function(){e.editors.TextEditor.prototype.open.apply(this,arguments);var t=e.Dom.outerHeight(this.TD),o=e.Dom.offset(this.instance.rootElement),n=e.Dom.offset(this.TD);this.unicodeModal.style.position="absolute",this.unicodeModal.style.top=n.top-o.top+t+"px",this.unicodeModal.style.left=n.left-o.left+"px",this.instance.addHook("beforeKeyDown",this.onBeforeKeyDown)},t.prototype.close=function(){this.hideModal(),this.instance.removeHook("beforeKeyDown",this.onBeforeKeyDown),e.editors.TextEditor.prototype.close.apply(this,arguments)},t.prototype.onBeforeKeyDown=function(e){var t=this,o=t.getActiveEditor();e.ctrlKey&&32===e.keyCode&&o.showModal(),27===e.keyCode&&o.modalOpened&&(o.hideModal(),e.stopImmediatePropagation(),e.preventDefault())},t.prototype.showModal=function(){this.modalOpened=!0,this.unicodeModal.style.display=""},t.prototype.hideModal=function(){this.modalOpened=!1,this.unicodeModal.style.display="none"};var o=function(e,t,o,n,r,d,a){return t.innerHTML=d,t};e.editors.UnicodeEditor=t,e.editors.registerEditor("unicode",t),e.renderers.UnicodeRenderer=o,e.renderers.registerRenderer("unicode",o),e.cellTypes.unicode={editor:e.editors.UnicodeEditor,renderer:e.renderers.UnicodeRenderer}}(Handsontable);